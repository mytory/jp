---
title: 配列を http Query String で 作って 与える 関数
author: 녹풍(綠風, Windgreen)
layout: post
permalink: /archives/628
aktt_notify_twitter:
  - yes
categories:
  - Web server
tags:
  - PHP
---
<pre class="brush:php">function http_parse_query( $array = NULL, $convention = &#039;%s&#039; ){
	if( count( $array ) == 0 ){
		return &#039;&#039;;
	} else {
		if( function_exists( &#039;http_build_query&#039; ) ){
			$query = http_build_query( $array );
		} else {
			$query = &#039;&#039;;
			foreach( $array as $key =&gt; $value ){
				if( is_array( $value ) ){
					$new_convention = sprintf( $convention, $key ) . &#039;[%s]&#039;;
					$query .= http_parse_query( $value, $new_convention );
				} else {
					$key = urlencode( $key );
					$value = urlencode( $value );
					$query .= sprintf( $convention, $key ) . "=$value&";
				}
			}
			$query = substr($query, 0, mb_strlen($query)-1);
		}
		return $query;
	}
}</pre>

URLを 分析して クイーリーストリングを 抜き出す 数 ある 関数である parse\_url , クイーリー ストリングを 配列で 変換して 与える 関数である parse\_str 科 一緒に 交ぜて 下のように 活用する 数 ある.

言語を 変更して 与える ファイルで, セッションと URLに 言語 情報を 入れて ハングルなら 英語で 英語なら ハングルで 切り替えて 与える.

敢えて URLに lang=en ような 情報を 入れる 理由は 検索エンジンに 対応すること ためだ.

<pre class="brush:php">if($_SESSION[&#039;language&#039;]==&#039;en&#039;){
	$_SESSION[&#039;language&#039;]=&#039;ko&#039;;
}else{
	$_SESSION[&#039;language&#039;]=&#039;en&#039;;
}
$parse = parse_url($_SERVER[&#039;HTTP_REFERER&#039;]);
$query_array = array();
if(isset($parse[&#039;query&#039;])){
	parse_str($parse[&#039;query&#039;], $query_array);
}
$query_array[&#039;lang&#039;]=$_SESSION[&#039;language&#039;];
$query_string = http_parse_query($query_array);
header(&#039;location: &#039;.$parse[&#039;path&#039;].&#039;?&#039;.$query_string);</pre>