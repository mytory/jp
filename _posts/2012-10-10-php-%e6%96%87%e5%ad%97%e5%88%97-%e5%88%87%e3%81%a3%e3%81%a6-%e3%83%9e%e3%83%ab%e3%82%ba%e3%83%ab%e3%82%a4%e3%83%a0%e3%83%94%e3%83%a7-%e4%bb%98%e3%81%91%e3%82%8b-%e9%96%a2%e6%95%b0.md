---
title: '[PHP] 文字列 切って マルズルイムピョ 付ける 関数'
author: 녹풍(綠風, Windgreen)
layout: post
permalink: /archives/573
aktt_notify_twitter:
  - yes
categories:
  - Web server
tags:
  - PHP
---
<pre class="brush:php">function text_dot($text, $len){
	$text = strip_tags($text);
	if(strlen($text)&lt;=$len) {
		return $text;
	} else {
		$text = htmlspecialchars_decode($text);
		$text = mb_strcut($text, 0, $len, &#039;utf-8&#039;);
		$text = htmlspecialchars($text);
		return $text."…";
	}
}</pre>

上 関数を 使えば 字を 切った 後 マルズルイムピョを 付ける.

## 特徴1 &#8211; `htmlspecialchars_decode` 関数

一応 <a title="< なんか 字を 元々どおり 返す php関数  htmlspecialchars_decode.php 具現関数" target="_top" href="http://mytory.local/archives/247"><code>htmlspecialchars_decode</code> 関数</a>を 使った.

HTMLで <私 >を 表現しようとすれば < おこるが > ような 形態で 使って 与えると する.

定木, <ハンギョレ> という 文字列が あると 思って 見よう. 前から 7バイトを 切ると 思おう. それでは &#8216;<ハンギョ&#8217; と 出る のだと 思う のだ. しかし ない. 関数は たぶん &#8216;<たいてい&#8217; 万 リターンする のだ. (UTF-8仕事 時 英文は 1バイト, ハングルは 3バイト 処理される.)

すなわち, HTMLで 使う 特殊文字の 文字列が 切られる 場合を 念頭に 置くと する のだ.

そのため DB あぶ 保存された 文字列 形態である &#8216;<ハンギョレ>&#8217;を `htmlspecialchars_decode()` を 利用して &#8216;<ハンギョレ>&#8217;路 作った 次 文字列を 切る のだ.

## 特徴2 -`mb_strcut` 関数

普通 文字列を 切る 時 `substr`を 使う ことだ. しかし これは アルファベットに 最適化された やつだ. これで ハングルを 切れば 字が 割れる 場合が 生ずる.

そのため `mb_strcut`おこるが `mb_substr`という 関数が 鳥で 出た. (鳥で 出たとしても もう PHP4.0.6 から あった の ようだ;; これ 二 関数は 違う 方法で ような 役目を 遂行する. 団, mb\_substr銀 因子値で 1これ 字詰めで, mb\_strcut銀 バイト数だ.)これら 関数の mb増えた multi-byte義 弱者だ.

これ 関数を 使えば ハングルも 割れるの なくて 寝る 切られる.

## 例題

下と 一緒に test.php なんかの ファイルを 作って 行って 見れば 関数を 寝る 理解する 数 ある のだ.

<pre class="brush:php">&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /&gt;
&lt;?
$str="abcわ!!!";
echo "元々 文字列: $str &lt;br/&gt;";
$after_substr4=substr($str,0,4);
$after_substr5=substr($str,0,5);
$after_substr6=substr($str,0,6);
$after_substr7=substr($str,0,7);
$after_substr8=substr($str,0,8);
$after_substr9=substr($str,0,9);
echo "after substr 4: $after_substr4 &lt;br/&gt;";
echo "after substr 5: $after_substr5 &lt;br/&gt;";
echo "after substr 6: $after_substr6 &lt;br/&gt;";
echo "after substr 7: $after_substr7 &lt;br/&gt;";
echo "after substr 8: $after_substr8 &lt;br/&gt;";
echo "after substr 9: $after_substr9 &lt;br/&gt;";

$after_mb_strcut4 = mb_strcut($str,0,4, "UTF-8" );
$after_mb_strcut5 = mb_strcut($str,0,5, "UTF-8" );
$after_mb_strcut6 = mb_strcut($str,0,6, "UTF-8" );
$after_mb_strcut7 = mb_strcut($str,0,7, "UTF-8" );
$after_mb_strcut8 = mb_strcut($str,0,8, "UTF-8" );
$after_mb_strcut9 = mb_strcut($str,0,9, "UTF-8" );
echo "after mb_strcut 4: $after_mb_strcut4 &lt;br/&gt;";
echo "after mb_strcut 5: $after_mb_strcut5 &lt;br/&gt;";
echo "after mb_strcut 6: $after_mb_strcut6 &lt;br/&gt;";
echo "after mb_strcut 7: $after_mb_strcut7 &lt;br/&gt;";
echo "after mb_strcut 8: $after_mb_strcut8 &lt;br/&gt;";
echo "after mb_strcut 9: $after_mb_strcut9 &lt;br/&gt;";

/*結果 -
元々 文字列: abcわ!!!
after substr 4: abc
after substr 5: abc
after substr 6: abcわ
after substr 7: abcわ!
after substr 8: abcわ!!
after substr 9: abcわ!!!
after mb_strcut 4: abc
after mb_strcut 5: abc
after mb_strcut 6: abcわ
after mb_strcut 7: abcわ!
after mb_strcut 8: abcわ!!
after mb_strcut 9: abcわ!!!
*/
?&gt;</pre>

`substr`路 4バイトや 5バイトを 切った 時 ハングルが 割れる のを 卵 数 ある. 特殊文字と 英文は 1バイト, ハングルは 3バイト 処理されるという のも 卵 数 ある.