---
title: '[ワードプレス]管理者記事の一覧で、custom taxonomyにフィルタリングできるようにする'
author: 녹풍(綠風, Windgreen)
layout: post
permalink: /archives/1905
categories:
  - WordPress
tags:
  - WordPress Tip
---
ワードプレスでショッピングモール似ているのを作っている. 製造社で製氷機を区分するように custom taxonomyを設定した. ところで管理者ページの文リストで製造社を土台で検索ができないということを見つけた.

まず初めて使った方法はワードプレス 3.5から入って行った機能を使うのだ. 文リストに custom taxonomyを見せてくれること. それでは文リストにある製造社をクリックした時該当の製造社でピルトリングになる. 下の絵のようにね. 下の絵の SIMAG みたいなことをクリックすれば該当の製造社のだけリストに出るようになる.

<div style="width: 756px" class="wp-caption aligncenter">
  <img alt="" src="http://dl.dropbox.com/u/15546257/blog/mytory/wp-custom-taxonomy-in-admin-list.png" width="746" height="192" /><p class="wp-caption-text">
    販売分類と製造社が Custom Taxonomyで, Ice-hello, SIMAG みたいなことが Termだ.
  </p>
</div>

これはこの文を見て分かったのだ :[WordPress 3.5 admin columns for custom taxonomies][1]

## ピルトリングができなければならない

しかしリストに表示されない製造社でピルトリングができないじゃないか? とにかく間に下のように作らなければならなかった.  
<img class="alignnone" alt="" src="http://dl.dropbox.com/u/15546257/blog/mytory/wp-custom-taxonomy-in-admin-list-2.png" width="665" height="68" />

分かるが, 作ってこの文を書くのだ. 上のように表示するためのコードは下のようだ. 販売分類も custom taxonomyだが, 製造使用コードだけ書く. 製造謝意 custom taxonomy slugは companyだった.

<pre>add_action('restrict_manage_posts','restrict_ice_machine_by_company')

/**
 * 製造社分類セレクトボックス出力
*/
function restrict_ice_machine_by_company() {
  global $typenow;
  global $wp_query;
  if ($typenow=='ice_machine') {
    $taxonomy = 'company';
    $taxonomy_info = get_taxonomy($taxonomy)
    $terms = get_terms($taxonomy) ?&gt;
    &lt;select name="&lt;?=$taxonomy?&gt;"&gt;
      &lt;option value="0"&gt;
        &lt;?=$taxonomy_info-&gt;labels-&gt;all_items?&gt;
      &lt;/option&gt;
      &lt;?
      foreach ($terms as $term) {
        $selected = $term-&gt;slug == $_GET[$taxonomy]?' selected ':''; ?&gt;
        &lt;option &lt;?=$selected?&gt; value="&lt;?=$term-&gt;slug?&gt;"&gt;&lt;?=$term-&gt;name?&gt;(&lt;?=$term-&gt;count?&gt;)&lt;/option&gt;
      &lt;?}?&gt;
    &lt;/select&gt;
  &lt;?}
}</pre>

原理が意外に単純だが, restrict\_manage\_postsというアクションにそのままセレクトボックスを出力する hookをかけるのだ. (hookが何やら知りたければ &#8216;[ワードプレス プラグイン 作り 基本 概念][2]&#8216;を一度読んで見なさい.) もちろん考慮するのはすべて考慮してしたことだ. このピルトリングボックスのために別に提供される関数みたいなことはないようだ.

一応 &#8216;company&#8217; taxonomyの termを皆呼んで来てそれで select タグ作って振り撤いたことだ. select ボックスの option valueは termの slugにならなければならない.

taxonomy 情報を呼んで来たのは, taxonomyの label 情報を呼んで来て select ボックスの初項目に &#8216;全体製造社&#8217; 同じ式で浮かべてくれるためだ.

これをすることに基本的に &#8216;[Adding a Taxonomy Filter to Admin List for a Custom Post Type?][3]&#8216;の助けをたくさん受けた.ところで時間がなくてすべて読んでしなかったし, コードだけ見て自分なりに作ったことだ. 知りたい人はあの文を精読して作っても良い.

以上だ.

 [1]: http://make.wordpress.org/core/2012/12/11/wordpress-3-5-admin-columns-for-custom-taxonomies/
 [2]: http://jp.mytory.local/archives/814 "ワードプレス プラグイン 作り 基本 概念"
 [3]: http://wordpress.stackexchange.com/questions/578/adding-a-taxonomy-filter-to-admin-list-for-a-custom-post-type