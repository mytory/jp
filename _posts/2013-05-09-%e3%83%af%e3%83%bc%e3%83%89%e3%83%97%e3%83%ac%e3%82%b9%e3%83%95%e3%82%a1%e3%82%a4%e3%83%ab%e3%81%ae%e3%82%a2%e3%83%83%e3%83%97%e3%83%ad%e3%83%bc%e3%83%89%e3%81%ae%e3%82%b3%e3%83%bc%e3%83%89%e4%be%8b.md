---
title: '[ワードプレス]ファイルのアップロードのコード例'
author: 녹풍(綠風, Windgreen)
layout: post
permalink: /archives/2028
categories:
  - WordPress
tags:
  - WordPress Tip
---
文字通り例です。時間がなくて説明は省略し、コードが。

    if( ! empty($_FILES)){
      $wp_upload_dir = wp_upload_dir();
    
      require_once(ABSPATH . 'wp-admin/includes/file.php');
      $fileinfo = wp_handle_upload($_FILES['添付ファイル'], array('test_form' => FALSE ));
      $wp_filetype = wp_check_filetype(basename($fileinfo['file']), null );
    
      $attachment = array(
        'guid' => $wp_upload_dir['url'] . '/' . basename($fileinfo['file']),
        'post_mime_type' => $wp_filetype['type'],
        'post_title' => preg_replace('/.[^.]+$/', '', basename($fileinfo['file'])),
        'post_content' => '',
        'post_status' => 'inherit'
      );
    
      $attach_id = wp_insert_attachment( $attachment, $fileinfo['file'], $post_id);
    
      require_once(ABSPATH . 'wp-admin/includes/image.php');
      $attach_data = wp_generate_attachment_metadata( $attach_id, $fileinfo['file'] );
      wp_update_attachment_metadata( $attach_id, $attach_data );
    }

クライアント側では、次のコードを参照ください。やはり時間がなくて`foreach`をない回した。世話をかけ道。

<pre><code class="php">$args = array(
  'post_type' =&gt; 'attachment',
  'numberposts' =&gt; null,
  'post_status' =&gt; null,
  'post_parent' =&gt; $post-&gt;ID
);
$attachments = get_posts($args);

if($attachments){?&gt;
  &lt;p&gt;
    첨부파일 :
    &lt;a href="&lt;?=wp_get_attachment_url($attachments[0]-&gt;ID)?&gt;"&gt;
      &lt;?=apply_filters('the_title', $attachments[0]-&gt;post_title);?&gt;
    &lt;/a&gt;
  &lt;/p&gt;
&lt;?}?&gt;</code></pre>