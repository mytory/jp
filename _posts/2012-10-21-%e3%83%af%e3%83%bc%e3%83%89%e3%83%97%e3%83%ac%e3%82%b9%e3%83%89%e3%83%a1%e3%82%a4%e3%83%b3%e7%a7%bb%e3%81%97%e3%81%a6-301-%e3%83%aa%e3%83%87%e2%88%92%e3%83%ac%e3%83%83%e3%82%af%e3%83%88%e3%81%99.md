---
title: 'ワードプレスドメイン移し検索エンジンに知らせる（301リダイレクトする） &#8211; マルチサイトまでされるようにする'
author: 녹풍(綠風, Windgreen)
layout: post
permalink: /archives/1717
aktt_notify_twitter:
  - yes
categories:
  - WordPress
---
*この文は開発者を対象にする文だから一般人は聞き取れないことがある. 一般人たちもドメインはいくらかかった移すことができるでしょうに, それは他の文を検索した方が良いことができる.

ドメインを mytory.co.krで mytory.localに変更した. 新たに作った日本語ブログである jp.mytory.co.kr を文ウェッブマスター道具に登録してみたら対象地域が韓国になっていて変更することができないことが分かるようになったからだ. 日本で私の日本語ブログ検索がよくできるようにするためには当然対象地域範囲が韓国以上ではなければならないと思って, .net ドメインを購入した. ([対象地域が特定国家ではないドメインリスト表示][1])

## データベースをダウンして探し変えるのをする

それではもう始めて見よう. 初めてすることはデータベースにあるドメインを直すことだ.

MySQLをバックアップ受けた後, エディットプラスみたいなことで開いて探し変えることにドメインを全部変更する. 私は mytory.co.krを mytory.localに全部変えた.

変えたファイルをアップロードしても何をしても真書, この前データベースをすっきり消して新たにあげる.もちろんその前に新しいドメインとホスティングが繋がれていなければならない.

このようにすれば一応 mytory.local にした時問題なしに作動するでしょう. もし誤作動があったら, キャッシュとクッキーを皆削除して見てテストしてほしい. 私はキャッシュのためかマルチサイト関して誤作動があった.

## 検索エンジンに知らせてくれる &#8211; 301 リデ−レックト

ドメインだけ変えたと全部ではない. ドメインが変われば, 新しいドメインにいる私の文は検索エンジンにはじめからまた評価を受けなければならないのだ. それほど差し置くことはできない. 方法がないか? 当然ある. 検索エンジンに &#8220;引き続き移したの&#8221; して知らせてくれれば良い. それを 301 リデ−レックトと言う.

もしワードプレスマルチサイトを使っていなかったら, 現在使うテーマの functions.php ファイル一番の上に下のコードを挿入すればいい.

<pre class="brush: php; gutter: true">if(strstr($_SERVER[&#039;HTTP_HOST&#039;], &#039;mytory.co.kr&#039;)){
    $new_host = str_replace(&#039;mytory.co.kr&#039;,&#039;mytory.local&#039;,$_SERVER[&#039;HTTP_HOST&#039;]);
    header("HTTP/1.1 301 Moved Permanently");
    header("location: http://" . $new_host .$_SERVER[&#039;REQUEST_URI&#039;] );
    exit;
}</pre>

上コードで当然 mytory.co.krは昔のドメイン, mytory.localは新しいドメインに変えて入れてくれなければならないつもりだ.

このコードの用途は, ブログ呼び出しされた時, ドメインを検査して mytory.co.krなら mytory.localで 301 リデ−レックトをするのだ.

## ワードプレスマルチサイトでは?

ところで変にワードプレスマルチサイトでは functions.phpにファイルを入れても作動しなかった. 多分 .htaccessが中間に動作を横取りするようだった. 甚だしくは index.phpに入れても作動しなかった.

それで他の方法を使うしかなかった. .htaccessには .htaccessで対応する事にした.

上コードで `301_redirect.php`という名前のファイルを一つ作った. そしてブログ最上位フォルダにファイルを入れた.

ブログ最上位フォルダの .htaccess ファイルを開く. (マルチサイトを使っていたらあるんだ. 正確に .htaccess ファイルだ. ファイル名ない. UNIX システムで .に始めるファイルは隠しファイルだ. 痛がるのはこれを活用することだ. それでファイル名がそのまま .htaccessだ.)

.htaccessを開いて一番の前に `php_value auto_prepend_file "/www/html/301_redirect.hp"` と入れる. ファイル名を 301_redirect.phpで作らなかったら自分が作ったファイル名を書いてくれれば良い.

このようにしたら立派に作動し始めた. もうこのファイルが検索エンジンにドメインが移転されたことだと立派に知らせてくれるようになるでしょう. 一般使用者たちも mytory.co.krで訪問した時自動で mytory.localにリデ−レックトするようになるはずで言葉だ.

## その他

ドメインを 移して 私だから 301 リデ－レックトだけ なく すると 割 蟹 かなり あった. まず グーグル アナルリティックスに 登録された ドメインも 変更すると した. グーグル ウェッブマスター 道具にも 新しい ドメインを 登録すると した. ジェットパック 統計も 鳥で 登録すると した. digiprove度 鳥で 登録した. ツイッター ツールも 鳥で 登録した. 次 ビューにも, 次 検索にも ブルログルを 鳥で 登録すると 割 の ようだ. ツイッター プロフィールと ペイスブック ページの 情報も 変更すると した. 内 ブログが リンクされて ある 数多い サイトたちは どうに 処理すると するか 分からない;; mytory.co.kr ドメインは 来年 4月まで お金を 納めて おいたが 1~2年 くらいは もっと 維持<del>すると する 蟹 ないか たかったり する.</del>しようと する.

そのため 教訓は **できるなら ドメインは 変更する 蟹 ない** する のだ.

## ドメイン 変更 後 訪問数 推移

ドメインを 変更した 後 グーグルで ほとんど 流入が 消えてから 3株 経って 回復が いい. ヒュ=3

<img src="http://dl.dropbox.com/u/15546257/blog/mytory/visits-count-after-changing-domain.png" alt="" width="764" height="292" />

これ 位 リスクを 抱く 考えが あったら ドメイン 変更を しても 良いという 結論

(そして 参照で 私は mytory.co.kr ドメインを 維持しながら リデ－レックトを させた だから 検索した 人々が 404 エラーを 会う 可能性は なかった. すなわち, ドメインを 移しながら mytory.co.kr ドメインの 順位も 一緒に 下落した ので 見れば なる. ヨトン 4週目に 正常化!)

 [1]: https://support.google.com/webmasters/bin/answer.py?hl=ja&answer=1347922