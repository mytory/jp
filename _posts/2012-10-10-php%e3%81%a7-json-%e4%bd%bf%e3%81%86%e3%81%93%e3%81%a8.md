---
title: PHPで JSON 使うこと
author: 녹풍(綠風, Windgreen)
layout: post
permalink: /archives/41
aktt_notify_twitter:
  - yes
categories:
  - Web server
tags:
  - PHP
---
jsonを 初め 勉強しようとする 人なら, 一応 コンパニオン なる 技術 文書を 精読しなさい.

*   <a href="http://www.ibm.com/developerworks/kr/library/wa-ajaxintro10/" target="_blank">Ajax マスターすること, Part 10:データ 送信に JSON 使うこと</a>
*   <a href="http://www.ibm.com/developerworks/kr/library/wa-ajaxintro11.html" target="_blank">Ajax マスターすること, Part 11:サーバー 側の JSON</a>

上の 二 ギスルムンでは IBMに ある 資料なのに, JSON義 概念を 本当 易しく 寝る 書いておいた.

## PHPで JSON 使うこと 準備物

一応 準備物. jsファイルは 必要 ない. **JSON銀 ジャバスクリプトに 基本に 内蔵している.**

> JSON銀 ネイティブ JavaScript フォーマットで, JavaScript 内で JSON データと 作業すること のために 特別な API私 トルキッが 必要 ない.  
> -<a href="http://www.ibm.com/developerworks/kr/library/wa-ajaxintro10/" target="_blank">Ajax マスターすること, Part 10:データ 送信に JSON 使うこと</a> 中

これを 強調して 置いた 理由は 私が jsファイルを 捜すために 時間を かなり むだ使いした だからだ;;

## PHP バージョン : 5.2.1 以上

PHP バージョンが 5.2.1 以上なら PHP江戸 JSONこれ 基本に 内蔵している. これ 場合に 使う 関数は 歳 持つ.

> <ul class="chunklist chunklist_book chunklist_children">
>   <li>
>     <a target="_top" href="http://kr.php.net/manual/en/function.json-decode.php">json_decode</a> JSON 文字列を PHP配列で 変える.
>   </li>
>   <li>
>     <a target="_top" href="http://kr.php.net/manual/en/function.json-encode.php">json_encode</a> PHP 配列を JSON 文字列で 変える.
>   </li>
>   <li>
>     <a target="_top" href="http://kr.php.net/manual/en/function.json-last-error.php">json_last_error</a> 最後に 起きた エラーを 返還する.
>   </li>
> </ul>
> 
> <p style="text-align: right;">
>   - <a href="http://kr.php.net/json" target="_blank">PHP.net JSON マニュアル 中</a>
> </p>

## PHP バージョン : 5.2.1 未満 4.3 以上

PHP バージョンが 5.2.1 未満で 4.3 以上なら(もし 分からなくて する 話なのに, 自分 php バージョンは phpinfo() 一つだけ 書いてくれれば 出る.) JSON ライブラリを 持って来ると する. 4.3見る 低ければ 初めから 支援 中 なる の ようだ. ところが このごろ 誰が 4.3 未満 バージョンを 使おうか. 心配する の ない よう.

JSONを PHPに 設置する 方法も ある の ようなのに, ホスティング 業社を 利用する 場合なら 設置してくれと言って 電話すると して 複雑な 数 ある.(事実 これ のさばってから 何やら 寝る 分かるのは できない. マン 下の ある リンクに 入って行って見れば 設置する 方法が あるから する 音だ.)

JSON ホームページは json.orgのに ここ 仮面 困り果てる. json ロジッグを 説明して あって, 言語別で 激 多様な ライブラリを リンクしておいたが それこそ 目 帰る. ここで また PHP竜 JSON ライブラリを 捜すために てこじた.

PHP JSON ライブラリ(JSON.php)増えた <a href="http://pear.php.net/package/Services_JSON/download/" target="_blank">Package Information: Services_JSON</a>を ダウンすれば なる.

JSON.php ファイルには Services_JSON クラスが ある. 次 例題のように 使えば なる.

<pre class="brush: php;">require &#039;JSON.php&#039;;

// create a new instance of Services_JSON
$json = new Services_JSON();

// convert a complexe value to JSON notation, and send it to the browser
$value = array(&#039;foo&#039;, &#039;bar&#039;, array(1, 2, &#039;baz&#039;), array(3, array(4)));
$output = $json-&gt;encode($value);

print($output);
// prints: ["foo","bar",[1,2,"baz"],[3,[4]]]

// accept incoming POST data, assumed to be in JSON notation
$input = file_get_contents(&#039;php://input&#039;, 1000000);
$value = $json-&gt;decode($input);</pre>

一応 Services_JSON 客体を $jsonイラン 名前で 生成して, 関数を 呼び出して 使う のだ.

配列 中に 配列を 保存する 形態で PHP 配列を 作って, $json->encode($array) 関数を 使えば なる.

## JavaScriptを 使う 時 気を付ける 点

普通は Ajaxを 使う 時 JSONを 使う ので 考えられる. そうだったら, 一応 文字列を JSON 客体で 作って 使う でしょうに, myJsonObjectを JSON 客体と 梔子. 内容を 呼び出そうとすれば 次と ような 方式が なると 割 のだ.

<pre class="brush: javascript; gutter: true; first-line: 1">myJsonObject.Child[0].name</pre>

ここで 強調して たい のは, Child街 色々 晴れる 場合には 配列で, したがって 当然 配列を 呼び出すと するという のだ. これを 度忘れする 時が 多くて 敢えて 少なかった.

例えば 次と ような JSON 文字列を JSON 客体で 作ったと 梔子.

<pre class="brush: jscript;">var people =
  { "programmers": [
    { "firstName": "Brett", "lastName":"McLaughlin", "email": "brett@newInstance.com" },
    { "firstName": "Jason", "lastName":"Hunter", "email": "jason@servlets.com" },
    { "firstName": "Elliotte", "lastName":"Harold", "email": "elharo@macfaq.com" }
   ],
  "authors": [
    { "firstName": "Isaac", "lastName": "Asimov", "genre": "science fiction" },
    { "firstName": "Tad", "lastName": "Williams", "genre": "fantasy" },
    { "firstName": "Frank", "lastName": "Peretti", "genre": "christian fiction" }
   ],
  "musicians": [
    { "firstName": "Eric", "lastName": "Clapton", "instrument": "guitar" },
    { "firstName": "Sergei", "lastName": "Rachmaninoff", "instrument": "piano" }
   ]
  }</pre>

そうだったら こういう 式で 呼び出すと する のだ.

<pre class="brush: jscript;">people.programmers[0].lastName;
people.authors[1].genre			// Value is "fantasy"
people.musicians[3].lastName		// Undefined. This refers to the fourth entry, and there isn&#039;t one
people.programmers.[2].firstName	// Value is "Elliotte"</pre>

## ajaxで JSON 文字列を 受けた 時 JSON 客体で 作る 命令語

これは 易しく 求める 数 あるが 保管 次元で 少なくて 置く.

<pre class="brush: jscript;highlight: [8]; ">function callback(){
	//readystate 要請 状態 -- 4 : complete
	if(xmlHttp.readyState == 4){
	//サーバーの 回答 状態 : 200 : ok
		if(xmlHttp.status == 200){
		// responseText -- サーバーで 回答した データ.
			var jsonData=xmlHttp.responseText;
			var myJSONObject=e v a l(&#039;(&#039;+jsonData+&#039;)&#039;);
		}
	}
}</pre>

8番(回) ラインが 重要なのに, JSON 文字列である jsonDataを eval 関数を 利用して 加工する. しきりに 保安 問題を 起こす 数 あると 真書 `e v a l` と 浮かべて 使った. 実際 コードで 使う 焚く 付けて 使えば なる.

## EUC-KR PHP JSON ハングル 処理

JSON銀 無条件 UTF-8引き継ぐと する. ところが ハングル エンコードが EUC-KRなら 疲れる. こういう 時 使う 数 ある 方法で 誰か urlencode(), urldecode() 関数で 処理する 方法を 書き留めたから リンクする.

<p style="text-align: center;">
  PHP で JSON 使うこと(今は 文が 消えた.)
</p>

これ 分 コードは 次と ようだ.

<pre class="brush: php;">$val = array(urlencode("エヒョ‾"), "1", 23);
$output = json_encode($val);
echo urldecode($output)."n";

//結果
//["エヒョ‾","1",23]</pre>